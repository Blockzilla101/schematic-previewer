#!/usr/bin/bash

lastDir=`pwd`
cd ../Mindustry
temp=`git status 2> /dev/null | head -n 1`;
echo "packing sprites on branch: ${temp:10}"
#./gradlew desktop:dist tools:pack --no-daemon
cd "${lastDir}"

[[ -d "./assets" ]] && rm -rf "./assets"

echo "Copying sprites"

mkdir "./assets"
cp "../Mindustry/core/assets/sprites/error.png" "./assets"
cp "../Mindustry/core/assets/sprites/sprites.aatls" "./assets"
cp "../Mindustry/core/assets/sprites/schematic-background.png" "./assets"

cp -r "../Mindustry/core/assets-raw/sprites_out" "./assets"
mv "./assets/sprites_out" "./assets/sprites"

lastDir=`pwd`
cd "../Mindustry"

cd "${lastDir}"

./gradlew dist --no-daemon -q

if [[ ! $? == '0' ]]; then
    echo "Build Failed"
    exit 1
fi

# cp  ./build/libs/previewer.jar ../Botzilla/schematic-previewer.jar

[[ $# -ne 0 ]] && exit 1

scp ./build/libs/previewer.jar nydus:/tmp/schematic-previewer.jar
ssh nydus cp /tmp/schematic-previewer.jar /opt/botzilla/schematic-previewer.jar
ssh nydus rm /tmp/schematic-previewer.jar
